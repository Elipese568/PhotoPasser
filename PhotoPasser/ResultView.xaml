<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="PhotoPasser.ResultView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:PhotoPasser"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
    xmlns:tk="using:CommunityToolkit.WinUI.Controls" 
    xmlns:controls="using:PhotoPasser.Controls"
    mc:Ignorable="d">
    <Page.Resources>
        <AcrylicBrush x:Key="PhotoBackgroundAcrylicFillColorDefaultBrush" TintColor="{ThemeResource SystemAccentColorLight2}" TintOpacity="0.24" TintLuminosityOpacity="0.4" FallbackColor="#F9F9F9" />
    </Page.Resources>
    <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
        <Grid.RowDefinitions>
            <RowDefinition Height="48" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid Padding="16,8" VerticalAlignment="Stretch" ColumnSpacing="16" Grid.Row="0" Background="{ThemeResource LayerFillColorDefault}" BorderBrush="{ThemeResource DividerStrokeColorDefault}" BorderThickness="0,0,0,1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" Text="{x:Bind ViewModel.CurrentResult.Name,Mode=OneWay}" Style="{ThemeResource BodyLargeStrongTextBlockStyle}" HorizontalAlignment="Left" VerticalAlignment="Center"/>
            <TextBlock Grid.Column="1" HorizontalAlignment="Left" VerticalAlignment="Center" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondary}">
                <Run x:Uid="ms-resource:///ProcessingPage/CreatedAtRun"/>
                <Run Text="{x:Bind ViewModel.CurrentResult.Date,Mode=OneWay}"/>
            </TextBlock>
            <tk:Segmented Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center" Name="ViewSelector" SelectedIndex="0">
                <tk:SegmentedItem Tag="DetailView">
                    <tk:SegmentedItem.Icon>
                        <FontIcon Glyph="&#xE8A1;" />
                    </tk:SegmentedItem.Icon>
                    <TextBlock x:Uid="ms-resource:///ResultView/DetailViewSelectionLabel"/>
                </tk:SegmentedItem>
                <tk:SegmentedItem Tag="FlipView">
                    <tk:SegmentedItem.Icon>
                        <FontIcon Glyph="&#xE799;" />
                    </tk:SegmentedItem.Icon>
                    <TextBlock x:Uid="ms-resource:///ResultView/FlipViewSelectionLabel"/>
                </tk:SegmentedItem>
                <tk:SegmentedItem Tag="LibraryView">
                    <tk:SegmentedItem.Icon>
                        <FontIcon Glyph="&#xF0E2;" />
                    </tk:SegmentedItem.Icon>
                    <TextBlock x:Uid="ms-resource:///ResultView/LibraryViewSelectionLabel"/>
                </tk:SegmentedItem>
            </tk:Segmented>
        </Grid>
        <tk:SwitchPresenter Grid.Row="1" Value="{Binding SelectedItem.Tag,ElementName=ViewSelector}">
            <tk:Case Value="DetailView">
                <Grid Padding="36" MaxWidth="900" VerticalAlignment="Center" HorizontalAlignment="Center" RowSpacing="36">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="1*" />
                    </Grid.RowDefinitions>
                    <Grid x:Name="DetailCard" RowSpacing="0" Padding="36,24" VerticalAlignment="Center" HorizontalAlignment="Center" ColumnSpacing="16" Background="{ThemeResource LayerFillColorAlt}" BorderBrush="{ThemeResource CardStrokeColorDefault}" BorderThickness="1" CornerRadius="{ThemeResource OverlayCornerRadius}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Grid VerticalAlignment="Center" HorizontalAlignment="Right" Width="333" Height="250" Grid.Row="0">
                            <Border Background="{ThemeResource LayerFillColorDefault}" CornerRadius="{ThemeResource ControlCornerRadius}">
                                <Image Source="{x:Bind ViewModel.CurrentResult.Photos[0].Path, Converter={StaticResource UriImageSourceConverter}, Mode=OneWay}" Stretch="UniformToFill" />
                            </Border>
                            <Border VerticalAlignment="Center" HorizontalAlignment="Right" Width="335" Height="252" Margin="-1" Grid.Row="0" Background="{StaticResource PhotoBackgroundAcrylicFillColorDefaultBrush}" CornerRadius="{ThemeResource ControlCornerRadius}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                                <Image Source="{x:Bind ViewModel.CurrentResult.Photos[0].Path, Converter={StaticResource UriImageSourceConverter}, Mode=OneWay}" Stretch="Uniform" />
                            </Border>
                        </Grid>
                        <Grid Grid.Column="1" Height="250" VerticalAlignment="Center" HorizontalAlignment="Left" RowSpacing="4">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <TextBlock Grid.Row="0" Text="{x:Bind ViewModel.CurrentResult.Name,Mode=OneWay}" Style="{ThemeResource TitleLargeTextBlockStyle}"/>

                            <TextBlock Grid.Row="1" Text="{x:Bind ViewModel.CurrentResult.Description,Mode=OneWay}"/>
                            <Border Grid.Row="2" Margin="0,0,0,8" HorizontalAlignment="Left" Height="1" Width="144" BorderBrush="{ThemeResource DividerStrokeColorDefault}" BorderThickness="1"/>
                            <StackPanel Grid.Row="3" Spacing="8" Orientation="Horizontal">
                                <StackPanel.Resources>
                                    <Style TargetType="TextBlock" BasedOn="{StaticResource CaptionTextBlockStyle}">
                                    </Style>
                                </StackPanel.Resources>
                                <TextBlock><Run Text="{x:Bind ViewModel.CurrentResult.Photos.Count, Mode=OneWay}"/> <Run x:Uid="ms-resource:///ResultView/PhotosCountUiSuffix"/></TextBlock>
                                <TextBlock><Run Text="{x:Bind GetSelectedItemTotalSize(ViewModel.CurrentResult.Photos), Mode=OneWay}"/></TextBlock>
                            </StackPanel>
                            <CommandBar Grid.Row="4">
                                <AppBarButton x:Name="FavoriteButton" x:Uid="ms-resource:///ResultView/FavoriteButton" Icon="{x:Bind ViewModel.CurrentResult.IsFavorite,Mode=OneWay,Converter={StaticResource FavoriteIconElementConverter}}" Click="FavoriteButton_Click"/>
                                <AppBarSeparator/>
                                <AppBarButton x:Name="EditButton" x:Uid="ms-resource:///ResultView/EditButton" Icon="Edit" Click="EditButton_Click"/>
                                <AppBarButton x:Name="DeleteButton" x:Uid="ms-resource:///ResultView/DeleteButton" Icon="Delete">
                                    <AppBarButton.Flyout>
                                        <Flyout>
                                            <Grid RowSpacing="8" Padding="8">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                </Grid.RowDefinitions>
                                                <TextBlock Grid.Row="0" x:Uid="ms-resource:///ResultView/DeleteResultTip"/>
                                                <Button Grid.Row="1" HorizontalAlignment="Right" Click="DeleteButton_Click" x:Uid="ms-resource:///ResultView/RealDeleteButton"/>
                                            </Grid>
                                        </Flyout>
                                    </AppBarButton.Flyout>
                                </AppBarButton>
                                <AppBarSeparator/>
                                <AppBarButton x:Name="GotoFileExplorerButton" x:Uid="ms-resource:///ResultView/GotoFileExplorerButton" Icon="OpenLocal" Click="GotoFileExplorerButton_Click"/>
                                <AppBarButton x:Name="ExportButton" x:Uid="ms-resource:///ResultView/ExportButton" Click="ExportButton_Click">
                                    <AppBarButton.Icon>
                                        <FontIcon Glyph="&#xE7B8;" />
                                    </AppBarButton.Icon>
                                </AppBarButton>
                            </CommandBar>
                        </Grid>
                    </Grid>
                    <Grid HorizontalAlignment="Stretch" Grid.Row="1" Visibility="{x:Bind GetCollectionVisibility(ViewModel.CurrentResult.PinnedPhotos),Mode=OneWay}" Padding="16" RowSpacing="16" Background="{ThemeResource LayerFillColorDefault}" BorderBrush="{ThemeResource CardStrokeColorDefault}" BorderThickness="1" CornerRadius="8" Height="256">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="1*" />
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" VerticalAlignment="Center" Style="{ThemeResource BodyStrongTextBlockStyle}" x:Uid="ms-resource:///ResultView/PinnedPhotosHeader"/>
                        <GridView HorizontalAlignment="Center" SelectionChanged="GridView_SelectionChanged" ScrollViewer.HorizontalScrollMode="Enabled" ScrollViewer.HorizontalScrollBarVisibility="Visible" SelectedIndex="0" Grid.Row="1" ItemsSource="{x:Bind ViewModel.CurrentResult.PinnedPhotos,Mode=OneWay}">
                            <GridView.ItemTemplate>
                                <DataTemplate x:DataType="local:PhotoInfo">
                                    <Grid Width="150" VerticalAlignment="Stretch" CornerRadius="{StaticResource OverlayCornerRadius}">
                                        <Image Source="{Binding Path, Converter={StaticResource UriImageSourceConverter}}"/>
                                        <Rectangle HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                                            <Rectangle.Fill>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                    <LinearGradientBrush.GradientStops>
                                                        <GradientStop Color="{ThemeResource CardBackgroundFillColorSecondaryTransparent}" Offset="0.0"/>
                                                        <GradientStop Color="{ThemeResource CardBackgroundFillColorSecondaryTransparent}" Offset="0.5"/>
                                                        <GradientStop Color="{ThemeResource CardBackgroundFillColorSecondarySoild}" Offset="0.8"/>
                                                        <GradientStop Color="{ThemeResource CardBackgroundFillColorSecondarySoild}" Offset="1"/>
                                                    </LinearGradientBrush.GradientStops>
                                                </LinearGradientBrush>
                                            </Rectangle.Fill>
                                        </Rectangle>
                                        <TextBlock Text="{Binding UserName}" HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="8" Style="{ThemeResource CaptionTextBlockStyle}"/>
                                        <Button Click="UnPinButton_Click" Style="{ThemeResource SubtleButtonStyle}" Margin="0,0,0,2" HorizontalAlignment="Right" VerticalAlignment="Bottom">
                                            <FontIcon Glyph="&#xE77A;" FontSize="12"/>
                                        </Button>
                                    </Grid>
                                </DataTemplate>
                            </GridView.ItemTemplate>
                            <GridView.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <ItemsStackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </GridView.ItemsPanel>
                            <GridView.ItemContainerStyle>
                                <Style TargetType="GridViewItem" BasedOn="{StaticResource DefaultGridViewItemStyle}">
                                    <Setter Property="VerticalContentAlignment" Value="Stretch"/>
                                </Style>
                            </GridView.ItemContainerStyle>
                            <GridView.ItemContainerTransitions>
                                <TransitionCollection>
                                    <AddDeleteThemeTransition />
                                </TransitionCollection>
                            </GridView.ItemContainerTransitions>
                        </GridView>
                    </Grid>
                </Grid>
            </tk:Case>
            <tk:Case Value="FlipView">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="1*" />
                        <RowDefinition Height="200" />
                    </Grid.RowDefinitions>
                    <controls:PhotoFlipView x:Name="ImageViewFlipView" Grid.Row="0" Background="Transparent" Photos="{x:Bind ViewModel.CurrentResult.Photos,Mode=OneWay}" SelectedIndex="0">
                        <controls:PhotoFlipView.HeaderTemplate>
                            <DataTemplate x:DataType="local:PhotoInfo">
                                <TextBlock Text="{x:Bind UserName}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </DataTemplate>
                        </controls:PhotoFlipView.HeaderTemplate>
                    </controls:PhotoFlipView>
                    <Grid Padding="16,12,16,8" RowSpacing="12" Grid.Row="1" Background="{ThemeResource LayerFillColorDefault}" BorderBrush="{ThemeResource DividerStrokeColorDefault}" BorderThickness="0,1,0,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="1*" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" VerticalAlignment="Center" Style="{ThemeResource BodyStrongTextBlockStyle}" x:Uid="ms-resource:///ResultView/PhotosSequenceHeader"/>
                        <GridView SelectionChanged="GridView_SelectionChanged" ItemTemplate="{StaticResource PhotoTransitionStyledItem}" ScrollViewer.HorizontalScrollMode="Enabled" ScrollViewer.HorizontalScrollBarVisibility="Visible" SelectedIndex="{x:Bind ImageViewFlipView.SelectedIndex,Mode=TwoWay}" HorizontalAlignment="Stretch" Grid.Row="1" ItemsSource="{x:Bind ViewModel.CurrentResult.Photos,Mode=OneWay}">
                            <GridView.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <ItemsStackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </GridView.ItemsPanel>
                            <GridView.ItemContainerStyle>
                                <Style TargetType="GridViewItem" BasedOn="{StaticResource DefaultGridViewItemStyle}">
                                    <Setter Property="VerticalContentAlignment" Value="Stretch"/>
                                </Style>
                            </GridView.ItemContainerStyle>
                        </GridView>
                    </Grid>
                </Grid>
            </tk:Case>
            <tk:Case Value="LibraryView">
                <controls:PhotoGalleryViewer Photos="{x:Bind ViewModel.CurrentResult.Photos, Mode=TwoWay}"
                                         CopyResolve="PhotoGalleryViewer_CopyResolve"
                                         CopyAsBitmapResolve="PhotoGalleryViewer_CopyAsBitmapResolve"
                                         CopyAsPathResolve="PhotoGalleryViewer_CopyAsPathResolve"
                                         RenameResolve="PhotoGalleryViewer_RenameResolve"
                                         IsDeleteEnabled="False"
                                         IsAddEnabled="False"
                                         ItemPanelBackground="Transparent"
                                         Title="{x:Bind ViewModel.CurrentResult.Name, Mode=OneWay}"
                                         x:Name="ResultGalleryView">
                    <controls:PhotoGalleryViewer.ExtendedOperations>
                        <controls:PhotoItemOperation x:Name="PinPhoto" 
                                                     x:Uid="ms-resource:///ResultView/PinPhotoOperation"
                                                     ShowAtCommandBar="True" 
                                                     Invoked="PinPhoto_Invoked" 
                                                     Mode="Both">
                            <controls:PhotoItemOperation.DescriptiveIcon>
                                <SymbolIcon Symbol="Pin"/>
                            </controls:PhotoItemOperation.DescriptiveIcon>
                        </controls:PhotoItemOperation>
                        <controls:PhotoGeneralOperation x:Uid="ms-resource:///ResultView/ContinueToFilterOperation"
                                                        ShowAtCommandBar="True" 
                                                        Invoked="ContinueToFilter_PhotoGeneralOperation_Invoked">
                            <controls:PhotoGeneralOperation.DescriptiveIcon>
                                <SymbolIcon Symbol="Filter"/>
                            </controls:PhotoGeneralOperation.DescriptiveIcon>
                        </controls:PhotoGeneralOperation>
                        <controls:PhotoItemOperation x:Name="ContinueToFilterBasedOnSelected" 
                                                     x:Uid="ms-resource:///ResultView/ContinueToFilterBasedOnSelectedOperation"
                                                     ShowAtCommandBar="False" 
                                                     Invoked="ContinueToFilterBasedOnSelected_Invoked" 
                                                     Mode="Multiply">
                            <controls:PhotoItemOperation.DescriptiveIcon>
                                <SymbolIcon Symbol="Filter"/>
                            </controls:PhotoItemOperation.DescriptiveIcon>
                        </controls:PhotoItemOperation>
                    </controls:PhotoGalleryViewer.ExtendedOperations>
                </controls:PhotoGalleryViewer>
            </tk:Case>
        </tk:SwitchPresenter>
    </Grid>
</Page>
