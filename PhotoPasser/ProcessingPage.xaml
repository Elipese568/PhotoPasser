<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="PhotoPasser.ProcessingPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:PhotoPasser"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:tk="using:CommunityToolkit.WinUI.Controls"
    xmlns:controls="using:PhotoPasser.Controls"
    xmlns:sys="using:System"
    mc:Ignorable="d">
    <Page.Resources>
        <local:FiltingItemTrumbullMaskBrushConverter x:Key="FitmbConverter">
            <local:FiltingItemTrumbullMaskBrushConverter.UnsetFill>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <LinearGradientBrush.GradientStops>
                        <GradientStop Color="{ThemeResource CardBackgroundFillColorSecondaryTransparent}" Offset="0.0"/>
                        <GradientStop Color="{ThemeResource CardBackgroundFillColorSecondaryTransparent}" Offset="0.5"/>
                        <GradientStop Color="{ThemeResource CardBackgroundFillColorSecondarySoild}" Offset="0.8"/>
                        <GradientStop Color="{ThemeResource CardBackgroundFillColorSecondarySoild}" Offset="1"/>
                    </LinearGradientBrush.GradientStops>
                </LinearGradientBrush>
            </local:FiltingItemTrumbullMaskBrushConverter.UnsetFill>
            <local:FiltingItemTrumbullMaskBrushConverter.FilteredFill>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <LinearGradientBrush.GradientStops>
                        <GradientStop Color="{ThemeResource CardBackgroundFillColorSecondaryTransparent}" Offset="0.0"/>
                        <GradientStop Color="{ThemeResource CardBackgroundFillColorSecondaryTransparent}" Offset="0.5"/>
                        <GradientStop Color="{ThemeResource SystemFillColorSuccessBackground}" Offset="0.8"/>
                        <GradientStop Color="{ThemeResource SystemFillColorSuccessBackground}" Offset="1"/>
                    </LinearGradientBrush.GradientStops>
                </LinearGradientBrush>
            </local:FiltingItemTrumbullMaskBrushConverter.FilteredFill>
            <local:FiltingItemTrumbullMaskBrushConverter.UnfilteredFill>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <LinearGradientBrush.GradientStops>
                        <GradientStop Color="{ThemeResource CardBackgroundFillColorSecondaryTransparent}" Offset="0.0"/>
                        <GradientStop Color="{ThemeResource CardBackgroundFillColorSecondaryTransparent}" Offset="0.5"/>
                        <GradientStop Color="{ThemeResource SystemFillColorCriticalBackground}" Offset="0.8"/>
                        <GradientStop Color="{ThemeResource SystemFillColorCriticalBackground}" Offset="1"/>
                    </LinearGradientBrush.GradientStops>
                </LinearGradientBrush>
            </local:FiltingItemTrumbullMaskBrushConverter.UnfilteredFill>
        </local:FiltingItemTrumbullMaskBrushConverter>
    </Page.Resources>
    <tk:SwitchPresenter Value="{x:Bind ViewModel.Step,Mode=OneWay}">
        <tk:Case Value="Setup">
            <Grid Padding="36,40">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <TextBlock x:Uid="ms-resource:///ProcessingPage/CreateResultTitleTextBlock" Grid.Row="0" Style="{ThemeResource TitleTextBlockStyle}"/>
                <TextBox x:Uid="ms-resource:///ProcessingPage/NameTextBox" Grid.Row="1" TextChanged="TextBox_TextChanged" Margin="0,36,0,0" Text="{x:Bind ViewModel.Name,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"/>
                <TextBox x:Uid="ms-resource:///ProcessingPage/DescriptionTextBox" Grid.Row="2" Margin="0,16,0,0" Text="{x:Bind ViewModel.Description,Mode=TwoWay}" AcceptsReturn="True"/>

                <StackPanel Grid.Row="3" Margin="0,24,0,0" Spacing="8" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <Button Style="{ThemeResource DefaultButtonStyle}" x:Name="ExitButton" Click="ExitButton_Click">
                        <Button.KeyboardAccelerators>
                            <KeyboardAccelerator Key="Escape"/>
                        </Button.KeyboardAccelerators>
                        <TextBlock x:Uid="ms-resource:///ProcessingPage/ExitButtonTextBlock"/>
                    </Button>
                    <Button Style="{ThemeResource AccentButtonStyle}" IsEnabled="False" x:Name="StartButton" Click="StartButton_Click">
                        <Button.KeyboardAccelerators>
                            <KeyboardAccelerator Key="Enter"/>
                        </Button.KeyboardAccelerators>
                        <TextBlock x:Uid="ms-resource:///ProcessingPage/StartButtonTextBlock"/>
                    </Button>
                </StackPanel>
            </Grid>
        </tk:Case>
        <tk:Case Value="Filting">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Grid Padding="16,8" VerticalAlignment="Stretch" ColumnSpacing="16" Grid.Row="0" Background="{ThemeResource LayerFillColorDefault}" BorderBrush="{ThemeResource DividerStrokeColorDefault}" BorderThickness="0,0,0,1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="{x:Bind ViewModel.Name,Mode=OneWay}" Style="{ThemeResource BodyLargeStrongTextBlockStyle}" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                    <TextBlock Grid.Column="1" HorizontalAlignment="Left" VerticalAlignment="Center" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondary}">
                        <Run x:Uid="ms-resource:///ProcessingPage/CreatedAtRun"/>
                        <Run Text="{x:Bind sys:DateTime.Now.ToString()}"/>
                    </TextBlock>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center" HorizontalAlignment="Right">
                        <Button Style="{ThemeResource DefaultButtonStyle}" KeyboardAcceleratorPlacementMode="Hidden">
                            <Button.KeyboardAccelerators>
                                <KeyboardAccelerator Key="Escape"/>
                            </Button.KeyboardAccelerators>
                            <Button.Flyout>
                                <Flyout>
                                    <Grid RowSpacing="8" Padding="8">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>
                                        <TextBlock TextAlignment="Left" Grid.Row="0">
                                            <Run x:Uid="ms-resource:///ProcessingPage/ExitWarningRun"/><LineBreak/>
                                            <Run x:Uid="ms-resource:///ProcessingPage/ExitConfirmRun"/>
                                        </TextBlock>
                                        <Button x:Uid="ms-resource:///Resources/YesButton" Grid.Row="1" HorizontalAlignment="Right" Click="ExitButton_Click"/>
                                    </Grid>
                                </Flyout>
                            </Button.Flyout>
                            <TextBlock x:Uid="ms-resource:///ProcessingPage/HeaderExitButtonTextBlock"/>
                        </Button>
                        <Button Style="{ThemeResource AccentButtonStyle}" Click="FinishButton_Click" KeyboardAcceleratorPlacementMode="Hidden">
                            <Button.KeyboardAccelerators>
                                <KeyboardAccelerator Key="Enter"/>
                            </Button.KeyboardAccelerators>
                            <TextBlock x:Uid="ms-resource:///ProcessingPage/FinishButtonTextBlock"/>
                        </Button>
                    </StackPanel>

                </Grid>
                <controls:PhotoFlipView SelectedIndex="{x:Bind ViewModel.SelectedPhotoIndex,Mode=TwoWay}" x:Name="ImageViewFlipView" Grid.Row="1" Photos="{x:Bind ViewModel.DisplayedPhotos}">
                    <controls:PhotoFlipView.HeaderTemplate>
                        <DataTemplate x:DataType="local:PhotoInfo">
                            <TextBlock Text="{x:Bind UserName}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </DataTemplate>
                    </controls:PhotoFlipView.HeaderTemplate>
                </controls:PhotoFlipView>
                <Grid Grid.Row="2" Padding="16,8" BorderBrush="{ThemeResource DividerStrokeColorDefault}" BorderThickness="0,1">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="8">
                        <AppBarButton x:Uid="ms-resource:///ProcessingPage/RejectAppBarButton" x:Name="RejectButton" Click="RejectButton_Click" Icon="Clear" LabelPosition="Default" HorizontalAlignment="Center">
                            <AppBarButton.KeyboardAccelerators>
                                <KeyboardAccelerator Key="Down" Invoked="Reject_KeyboardAccelerator_Invoked"/>
                            </AppBarButton.KeyboardAccelerators>
                        </AppBarButton>
                        <AppBarButton x:Uid="ms-resource:///ProcessingPage/AcceptAppBarButton" x:Name="AcceptButton" Click="AcceptButton_Click" Icon="Accept" LabelPosition="Default" HorizontalAlignment="Center">
                            <AppBarButton.KeyboardAccelerators>
                                <KeyboardAccelerator Key="Up" Invoked="Accept_KeyboardAccelerator_Invoked"/>
                            </AppBarButton.KeyboardAccelerators>
                        </AppBarButton>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center" Spacing="8">
                        <TextBlock x:Uid="ms-resource:///ProcessingPage/RejectedLabelTextBlock" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondary}"/>
                        <TextBlock Text="{x:Bind ViewModel.RejectedCount,Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondary}"/>
                        <TextBlock Text="{x:Bind CountToPrecentStr(ViewModel.RejectedCount, ViewModel.FiltingPhotos.Count),Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondary}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Spacing="8">
                        <TextBlock Text="{x:Bind CountToPrecentStr(ViewModel.AcceptedCount, ViewModel.FiltingPhotos.Count),Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondary}"/>
                        <TextBlock Text="{x:Bind ViewModel.AcceptedCount,Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondary}"/>
                        <TextBlock x:Uid="ms-resource:///ProcessingPage/AcceptedLabelTextBlock" Style="{ThemeResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondary}"/>
                    </StackPanel>
                </Grid>
                <Grid Padding="16,12,16,8" Height="256" RowSpacing="12" Grid.Row="3" Background="{ThemeResource LayerFillColorDefault}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="1*" />
                    </Grid.RowDefinitions>

                    <TextBlock x:Uid="ms-resource:///ProcessingPage/PhotosHeaderTextBlock" Grid.Row="0" VerticalAlignment="Center" Style="{ThemeResource BodyStrongTextBlockStyle}"/>
                    <GridView SelectionChanged="GridView_SelectionChanged" ScrollViewer.HorizontalScrollMode="Enabled" ScrollViewer.HorizontalScrollBarVisibility="Visible" SelectedIndex="{x:Bind ImageViewFlipView.SelectedIndex,Mode=TwoWay}" HorizontalAlignment="Stretch" Grid.Row="1" ItemsSource="{x:Bind ViewModel.FiltingPhotos,Mode=OneWay}">
                        <GridView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <ItemsStackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </GridView.ItemsPanel>
                        <GridView.ItemContainerStyle>
                            <Style TargetType="GridViewItem" BasedOn="{StaticResource DefaultGridViewItemStyle}">
                                <Setter Property="VerticalContentAlignment" Value="Stretch"/>
                            </Style>
                        </GridView.ItemContainerStyle>

                        <GridView.ItemTemplate>
                            <DataTemplate x:DataType="local:FiltingPhotoInfo">
                                <Grid Width="150" VerticalAlignment="Stretch" CornerRadius="{StaticResource OverlayCornerRadius}">
                                    <Image Source="{x:Bind Path, Converter={StaticResource UriImageSourceConverter}}"/>
                                    <Rectangle HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Fill="{x:Bind Status,Mode=OneWay,Converter={StaticResource FitmbConverter}}">
                                    </Rectangle>
                                    <TextBlock Text="{x:Bind UserName}" HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="8" Style="{ThemeResource CaptionTextBlockStyle}"/>
                                </Grid>
                            </DataTemplate>
                        </GridView.ItemTemplate>
                    </GridView>
                </Grid>
            </Grid>
        </tk:Case>
    </tk:SwitchPresenter>
</Page>